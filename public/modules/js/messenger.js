function setChatSize(){$("#send-message").css("width",$("#wnd_messenger").width()-40+"px")}$(document).ready(function(){setChatSize(),$("#wnd_messenger").bind("dialogresize",function(n,s){setChatSize()});var n=io.connect(backendServer,{"force new connection":!0,secure:!0}),s=($("#nickError"),$("#nickname"),$("#users")),e=$("#send-message"),t=$("#message"),a=$("#chat");n.on("connecting",function(n){a.append('<li><span class="msg">Connecting to chat service...</span></li>')}),n.on("connect",function(n){a.append('<li><span class="msg">Connected!</span></li>')}),n.emit("new user",username,function(){}),n.on("usernames",function(n){var e="<h1>USERS:</h1>";for(i=0;i<n.length;i++)e+='<span class="wuser">'+n[i]+"</span><br />";s.html(e),$(".wuser").click(function(){t.val("/w "+$(this).html()+" "),t.focus()})}),e.submit(function(s){""!=t.val()&&(n.emit("send message",t.val(),function(n){a.append('<span class="error">'+n+"</span><br/>")}),t.val("")),s.preventDefault()}),n.on("new message",function(n){a.append('<li class="tooltip"><span class="tooltiptext">'+n.timestamp+'</span><span class="msg"><b>'+n.nick+": </b>"+$("<span>"+n.msg+"</span>").text()+"</span></li>"),$("#chatBox").animate({scrollTop:$("#chatBox")[0].scrollHeight},1e3)}),n.on("whisper",function(n){a.append('<li class="tooltip"><span class="tooltiptext">'+n.timestamp+'</span><span class="whisper"><b>'+n.nick+": </b>"+$("<span>"+n.msg+"</span>").text()+"</span></li>"),$("#chatBox").animate({scrollTop:$("#chatBox")[0].scrollHeight},1e3)}),$("#wnd_messenger").dialog({autoOpen:!0}).bind("dialogbeforeclose",function(s,e){n.emit("disconnect",function(n){}),n.disconnect()})});
