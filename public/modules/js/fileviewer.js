jQuery(document).ready(function(e){function t(){e(".fileinspector_filetree").on("changed.jstree",function(t,i){if(i.selected.length&&i.instance.get_node(i.selected[0]).original.fid){var o=i.instance.get_node(i.selected[0]).original.fid;e.ajax({type:"POST",dataType:"json",cache:!1,url:"/game/module/FileViewer/ajax/open",data:{_token:window.Laravel.csrfToken,fid:o},success:function(t){!0===t.result?!1===t.encrypted?"image"===t.filetype?(e(".fileinspector_div").css("background-image","url('"+wwwRoot+t.content+"')"),e(".fileinspector_div").show(),e(".fileinspector_filecontent").hide()):(e(".fileinspector_filecontent").text(t.content),e(".fileinspector_div").hide(),e(".fileinspector_filecontent").show()):(e(".fileinspector_filecontent").text(""),e.notification({title:"File Inspector",icon:"b",color:"#fff",content:"The selected file is encrypted!",timeout:4e3})):e(".fileinspector_filecontent").text("")}})}}).jstree({core:{themes:{name:"default-dark",icons:!0,url:"css/jstree/style.min.css"},data:{url:"/game/module/FileViewer/get/list",data:{_token:window.Laravel.csrfToken,hostID:fileViewerHost,hostPassword:fileViewerHostPassword},dataType:"json"}},plugins:["contextmenu","wholerow"],contextmenu:{items:function(){return!(atob(fileViewerModuleVersion)<=1)&&(0!=fileViewerHost&&{download:{separator_before:!1,separator_after:!1,label:"Download",action:function(t){var i=e.jstree.reference(t.reference).get_node(t.reference);e.ajax({type:"POST",dataType:"json",cache:!1,url:"/game/module/FileViewer/ajax/downloadFile",data:{_token:window.Laravel.csrfToken,fid:i.original.fid,server_password:fileViewerHostPassword},success:function(e){!0===e.result?alert("Downloaded: "+i.text):alert("DOWNLOAD FAILED")}})}}})}}})}e("#fileViewer-browse-local").click(function(){e("#hostAddress").val(""),fileViewerHost=0,e(".fileinspector_filetree").remove(),e("#fileinspector_left").append('<div class="fileinspector_filetree"></div>'),t()}),e("#fileViewer-connect").click(function(){e.ajax({type:"POST",dataType:"json",cache:!1,url:"/game/module/FileViewer/ajax/connectToRemoteServer",data:{_token:window.Laravel.csrfToken,host:e("#hostAddress").val(),password:fileViewerHostPassword},success:function(i){!0===i.result?(fileViewerHost=i.host,e(".fileinspector_filetree").remove(),e("#fileinspector_left").append('<div class="fileinspector_filetree"></div>'),t()):alert(i.message)}})}),t()});
